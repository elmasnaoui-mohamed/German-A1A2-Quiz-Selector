<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deutsch A1/A2 — Quiz (DE–AR)</title>

  <!-- Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Inter:wght@400;600;700;900&display=swap"
    rel="stylesheet">

  <style>
    :root {
      --bg: #0b1220;
      --card: #0f172a;
      --muted: #1f2a44;
      --muted-2: #172033;
      --text: #e6edf3;
      --text-weak: #c9d2da;
      --brand: #22d3ee;
      --ok: #10b981;
      --bad: #ef4444;
      --ring: #334155;
      --yellow: #eab308;
    }

    * {
      box-sizing: border-box;
      font-family: 'Cairo', 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      background: linear-gradient(180deg, #0b1220 0%, #0c1526 100%);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .container {
      width: 100%;
      max-width: 720px;
      background: var(--card);
      border: 1px solid #0b213d;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .35)
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 12px 16px;
      background: var(--muted-2);
      border-bottom: 1px solid #0f2749;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .title {
      font-weight: 900;
      letter-spacing: .4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title .flag {
      font-size: 20px
    }

    .top-actions {
      display: flex;
      gap: 8px;
      align-items: center
    }

    .btn {
      appearance: none;
      border: 1px solid transparent;
      background: var(--muted);
      color: #fff;
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 800;
      cursor: pointer;
      transition: transform .12s ease, background .2s ease, border-color .2s ease;
      font-size: 14px;
    }

    .btn:hover {
      transform: translateY(-1px)
    }

    .btn:active {
      transform: translateY(0) scale(.98)
    }

    .btn.brand {
      background: var(--brand);
      color: #03131a;
    }

    .btn.brand:hover {
      background: #3ae7ff
    }

    .btn.ghost {
      background: transparent;
      border-color: #1e3356
    }

    .btn.warn {
      background: #2a0f12;
      border-color: #431317;
      color: #ffb4b4
    }

    .content {
      padding: 16px
    }

    .stack {
      display: flex;
      flex-direction: column;
      gap: 12px
    }

    .card {
      background: #0e1a2e;
      border: 1px solid #0f2749;
      border-radius: 16px;
      padding: 16px
    }

    .center {
      text-align: center
    }

    .muted {
      color: var(--text-weak)
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px
    }

    @media (min-width:520px) {
      .grid-2 {
        grid-template-columns: 1fr 1fr
      }
    }

    .progress {
      height: 8px;
      background: #10223f;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid #163059
    }

    .progress>div {
      height: 100%;
      width: 0%;
      background: var(--brand);
      transition: width .3s ease
    }

    .question {
      font-size: 20px;
      font-weight: 900;
      text-align: center;
      line-height: 1.35
    }

    .meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 6px
    }

    .pill {
      border: 1px solid rgba(34, 211, 238, .5);
      color: #9ceefa;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 800
    }

    .topic {
      font-size: 12px;
      font-weight: 800;
      color: #9abbd6
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px
    }

    .option {
      border: 1px solid #24527a;
      background: #1a2944;
      color: #eaf6ff;
      border-radius: 12px;
      padding: 12px;
      text-align: right;
      cursor: pointer;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .option:hover {
      background: #234a72;
      border-color: #34d0ff
    }

    .opt-index {
      color: #bfefff;
      opacity: .95;
      font-family: monospace
    }

    .option.correct {
      background: rgba(16, 185, 129, .22);
      border-color: #10b981;
      color: #eafff5
    }

    .option.wrong {
      background: rgba(239, 68, 68, .22);
      border-color: #ef4444
    }

    .footer-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 16px
    }

    .left-actions {
      display: flex;
      align-items: center;
      gap: 8px
    }

    .hint {
      background: #0a1c31;
      border: 1px dashed #28517e;
      border-radius: 12px;
      padding: 10px 12px;
      color: #bfd9f1;
      font-size: 13px
    }

    .hint b {
      color: #89e4ff
    }

    .ltr {
      direction: ltr;
      unicode-bidi: bidi-override
    }

    .rtl {
      direction: rtl
    }

    .hidden {
      display: none !important
    }

    .results-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px
    }

    @media (min-width:680px) {
      .results-grid {
        grid-template-columns: 1fr 1fr
      }
    }

    .badge {
      background: #0d263d;
      border: 1px solid #1c3f64;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 900
    }

    .badge.ok {
      background: rgba(16, 185, 129, .2);
      border-color: #10b981
    }

    .badge.bad {
      background: rgba(239, 68, 68, .2);
      border-color: #ef4444
    }

    .review-item {
      border: 1px solid #17365a;
      background: #0c1a2f;
      border-radius: 12px;
      padding: 12px
    }

    .review-q {
      font-weight: 900;
      margin-bottom: 6px
    }

    .review-ex {
      font-size: 13px;
      color: #b5cce3
    }

    .resume {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      background: #0c1a2f;
      border: 1px solid #17426d;
      padding: 10px 12px;
      border-radius: 12px
    }

    .toast {
      position: fixed;
      bottom: 18px;
      inset-inline: 18px;
      max-width: 720px;
      margin: 0 auto;
      display: none
    }

    .toast .inner {
      background: #0a1f33;
      border: 1px solid #1a3656;
      padding: 12px 14px;
      border-radius: 12px;
      text-align: center
    }

    .toast.show {
      display: block
    }

    @media (max-width: 480px) {
      .btn {
        font-size: 13px;
        padding: 9px 12px;
      }

      .question {
        font-size: 18px;
      }

      .option {
        font-size: 15px;
        padding: 10px;
      }

      .topbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }

      .top-actions {
        width: 100%;
        justify-content: space-between;
      }

      .progress>div {
        transition: width .25s ease;
      }

      .container {
        border-radius: 14px;
      }

      .card {
        border-radius: 12px;
        padding: 14px;
      }
    }
  </style>
</head>

<body>

  <main class="container" id="app">
    <div class="topbar">
      <div class="title">
        <span class="flag" aria-hidden="true">🇩🇪</span>
        <span>Deutsch <span class="muted">/ عربي</span></span>
      </div>
      <div class="top-actions">
        <button id="resetBtn" class="btn warn hidden" title="إعادة التعيين — Zurücksetzen">🔄 إعادة •
          Zurücksetzen</button>
        <button id="homeBtn" class="btn ghost hidden" title="العودة إلى الصفحة الرئيسية — Startseite">🏠 الرئيسية •
          Startseite</button>
      </div>
    </div>

    <section id="start" class="content stack">
      <div id="resumeBanner" class="resume hidden">
        <div>
          <div class="muted" style="font-size:13px; font-weight:800">متابعة التقدم — <span class="ltr">Fortschritt
              fortsetzen</span></div>
          <div id="resumeMeta" style="font-size:12px" class="muted"></div>
        </div>
        <div class="top-actions">
          <button id="resumeBtn" class="btn brand">استئناف • Fortsetzen</button>
          <button id="discardBtn" class="btn ghost">بدء جديد • Neu starten</button>
        </div>
      </div>

      <div class="card center">
        <h1 style="margin:6px 0 10px 0; font-size:26px" class="ltr">Wähle deinen Quiz-Typ</h1>
        <div class="muted" style="font-weight:800">اختر نوع الاختبار (ألماني/عربي فقط)</div>
        <div class="grid-2" style="margin-top:14px">
          <button id="btnGrammar" class="btn brand" style="width:100%; font-size:18px; padding:18px">🇩🇪 Grammatik •
            القواعد</button>
          <button id="btnVocab" class="btn brand" style="width:100%; font-size:18px; padding:18px">🗣️ Wortschatz •
            المفردات</button>
        </div>
        <div class="hint" style="margin-top:12px">
          <b>تلميح / Hinweis:</b> تقدمك يُحفَظ تلقائياً على هذا الجهاز. يمكنك الرجوع لاحقاً والمتابعة.
        </div>
      </div>
    </section>

    <section id="quiz" class="content hidden">
      <div class="stack">
        <div class="card">
          <div class="progress">
            <div id="progressFill"></div>
          </div>
          <div class="meta">
            <div class="topic" id="topic"></div>
            <div class="pill" id="level"></div>
          </div>
        </div>

        <div class="card">
          <div id="question" class="question">…</div>
          <div id="options" class="options"></div>

          <div class="footer-actions">
            <div class="left-actions">
              <button id="nextBtn" class="btn">التالي • Weiter</button>
              <button id="prevBtn" class="btn ghost">← السابق • Zurück</button>
            </div>
            <div class="muted" id="progressText">0 / 0</div>
          </div>

          <div id="translation" class="hint hidden" style="margin-top:10px"></div>
        </div>
      </div>
    </section>

    <section id="results" class="content hidden">
      <div class="stack">
        <div class="card center">
          <h2 style="margin:6px 0 10px 0; font-size:26px">النتائج • Ergebnisse</h2>
          <div class="results-grid">
            <div class="badge ok">✅ صحيحة • Richtig: <span id="rightCount">0</span></div>
            <div class="badge bad">❌ خاطئة • Falsch: <span id="wrongCount">0</span></div>
          </div>
          <div class="hint" style="margin-top:12px" id="scoreMsg"></div>
          <div class="top-actions" style="justify-content:center; margin-top:12px">
            <button id="againBtn" class="btn brand">إعادة • Nochmal</button>
            <button id="homeBtn2" class="btn ghost">🏠 الرئيسية • Startseite</button>
          </div>
        </div>

        <div id="review" class="card hidden">
          <h3 style="margin:0 0 10px 0">مراجعة الأسئلة الخاطئة • Falsche Fragen</h3>
          <div id="reviewList" class="stack"></div>
        </div>
      </div>
    </section>
  </main>

  <div class="toast" id="toast">
    <div class="inner" id="toastText"></div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const els = {
      start: $('start'), quiz: $('quiz'), results: $('results'),
      btnGrammar: $('btnGrammar'), btnVocab: $('btnVocab'),
      homeBtn: $('homeBtn'), resetBtn: $('resetBtn'), homeBtn2: $('homeBtn2'),
      resumeBanner: $('resumeBanner'), resumeMeta: $('resumeMeta'), resumeBtn: $('resumeBtn'), discardBtn: $('discardBtn'),
      progressFill: $('progressFill'), progressText: $('progressText'),
      question: $('question'), options: $('options'), nextBtn: $('nextBtn'), prevBtn: $('prevBtn'),
      topic: $('topic'), level: $('level'), translation: $('translation'),
      rightCount: $('rightCount'), wrongCount: $('wrongCount'), scoreMsg: $('scoreMsg'),
      againBtn: $('againBtn'), review: $('review'), reviewList: $('reviewList'),
      toast: $('toast'), toastText: $('toastText')
    };

    const DATA_FILES = {
      Grammatik: 'quizDataGrammar.json',
      Wortschatz: 'quizDataVocabulary.json'
    };

    const initialState = () => ({
      mode: 'start',
      quizType: null,
      file: null,
      questions: [],
      index: 0,
      answers: [],
      correct: 0,
      finished: false,
      updatedAt: Date.now()
    });

    let state = initialState();

    const keyFor = (type) => `quiz-progress::${type || 'unknown'}`;

    function show(area) {
      [els.start, els.quiz, els.results].forEach(a => a.classList.add('hidden'));
      area.classList.remove('hidden');
    }

    function toast(msg) {
      els.toastText.textContent = msg;
      els.toast.classList.add('show');
      setTimeout(() => els.toast.classList.remove('show'), 1800);
    }

    function save() {
      if (!state.quizType) return;
      state.updatedAt = Date.now();
      const saveObj = {
        mode: state.mode, quizType: state.quizType, file: state.file,
        index: state.index, answers: state.answers, correct: state.correct, finished: state.finished,
        updatedAt: state.updatedAt
      };
      localStorage.setItem(keyFor(state.quizType), JSON.stringify(saveObj));
      updateTopbarButtons();
    }

    function hasSaved(type) {
      try {
        const raw = localStorage.getItem(keyFor(type));
        if (!raw) return null;
        return JSON.parse(raw);
      } catch (_) { return null; }
    }

    function clearSaved(type) {
      localStorage.removeItem(keyFor(type));
      updateTopbarButtons();
    }

    async function fetchData(file) {
      const res = await fetch(file);
      if (!res.ok) throw new Error(`Failed to load ${file}: ${res.status}`);
      return res.json();
    }

    function updateTopbarButtons() {
      const inCategory = state.mode === 'quiz' || state.mode === 'results';
      const anySaved = !!hasSaved('Grammatik') || !!hasSaved('Wortschatz');
      const currentSaved = state.quizType ? !!hasSaved(state.quizType) : false;

      if (inCategory) { els.homeBtn.classList.remove('hidden'); }
      else { els.homeBtn.classList.add('hidden'); }

      const shouldShowReset = inCategory ? currentSaved : anySaved;
      if (shouldShowReset) { els.resetBtn.classList.remove('hidden'); }
      else { els.resetBtn.classList.add('hidden'); }
    }

    function renderStart() {
      show(els.start);
      const g = hasSaved('Grammatik');
      const v = hasSaved('Wortschatz');
      let pick = null;
      if (g && v) { pick = (g.updatedAt > v.updatedAt) ? g : v; }
      else pick = g || v;

      if (pick && !pick.finished) {
        els.resumeBanner.classList.remove('hidden');
        const t = new Date(pick.updatedAt);
        const de = pick.quizType === 'Grammatik' ? 'Grammatik' : 'Wortschatz';
        els.resumeMeta.innerHTML = `نوع: <b>${de}</b> • سؤال: <b>${pick.index + 1}</b> • آخر حفظ: <b class="ltr">${t.toLocaleString()}</b>`;
        els.resumeBtn.onclick = () => resume(pick);
        els.discardBtn.onclick = () => { clearSaved(pick.quizType); renderStart(); toast('تم تجاهل التقدم — Fortschritt verworfen'); };
      } else {
        els.resumeBanner.classList.add('hidden');
      }
      updateTopbarButtons();
    }

    async function start(type) {
      state = initialState();
      state.mode = 'quiz';
      state.quizType = type;
      state.file = DATA_FILES[type];
      const saved = hasSaved(type);
      if (saved && !saved.finished) {
        state.index = saved.index || 0;
        state.answers = saved.answers || [];
        state.correct = saved.correct || 0;
      }
      state.questions = await fetchData(state.file);
      if (!Array.isArray(state.answers) || state.answers.length !== state.questions.length) {
        state.answers = Array(state.questions.length).fill(null);
      }
      save();
      renderQuestion();
      show(els.quiz);
      updateTopbarButtons();
    }

    async function resume(saved) {
      state = initialState();
      state.mode = saved.mode || 'quiz';
      state.quizType = saved.quizType;
      state.file = saved.file;
      state.index = saved.index || 0;
      state.answers = saved.answers || [];
      state.correct = saved.correct || 0;
      state.finished = !!saved.finished;
      state.questions = await fetchData(state.file || DATA_FILES[state.quizType]);
      if (!Array.isArray(state.answers) || state.answers.length !== state.questions.length) {
        state.answers = Array(state.questions.length).fill(null);
      }
      if (state.finished) {
        renderResults(); show(els.results);
      } else {
        renderQuestion(); show(els.quiz);
      }
      updateTopbarButtons();
    }

    function updateProgressUI() {
      const total = state.questions.length;
      const idx = Math.min(state.index, total - 1);
      const pct = total ? Math.round((idx) / total * 100) : 0;
      els.progressFill.style.width = pct + '%';
      els.progressText.textContent = `${idx} / ${total}`;
    }

    function renderQuestion() {
      const q = state.questions[state.index];
      if (!q) { return; }
      els.topic.textContent = q.topic || '';
      els.level.textContent = q.level || '';
      els.translation.classList.add('hidden');
      els.translation.innerHTML = '';

      els.question.innerHTML = `<span class="ltr"><strong>${q.question}</strong></span>`;
      els.options.innerHTML = '';

      q.options.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'option';
        btn.innerHTML = `<span class="opt-index">${i + 1}.</span> <span class="ltr">${opt}</span>`;
        btn.onclick = () => selectOption(i);
        const chosen = state.answers[state.index];
        if (chosen !== null) {
          if (i === q.correctAnswerIndex) btn.classList.add('correct');
          else if (i === chosen) btn.classList.add('wrong');
        }
        els.options.appendChild(btn);
      });

      els.prevBtn.disabled = state.index === 0;
      els.nextBtn.textContent = (state.index === state.questions.length - 1) ? 'إنهاء • Beenden' : 'التالي • Weiter';

      updateProgressUI();
      save();
      updateTopbarButtons();
    }

    function selectOption(i) {
      const q = state.questions[state.index];
      const prev = state.answers[state.index];

      state.answers[state.index] = i;
      if (prev === null) {
        if (i === q.correctAnswerIndex) state.correct += 1;
      } else {
        const wasCorrect = (prev === q.correctAnswerIndex);
        const nowCorrect = (i === q.correctAnswerIndex);
        if (!wasCorrect && nowCorrect) state.correct += 1;
        if (wasCorrect && !nowCorrect) state.correct -= 1;
      }

      [...els.options.children].forEach((el, idx) => {
        el.classList.remove('correct', 'wrong');
        if (idx === q.correctAnswerIndex) el.classList.add('correct');
        else if (idx === i) el.classList.add('wrong');
      });

      const parts = [];
      if (q.translation) parts.push(`الترجمة: <b>${q.translation}</b>`);
      if (q.example) parts.push(`مثال / Beispiel: <span class="ltr"><b>${q.example}</b></span>`);
      if (parts.length) {
        els.translation.innerHTML = parts.join('<br/>');
        els.translation.classList.remove('hidden');
      }
      save();
    }

    function next() {
      if (state.index < state.questions.length - 1) {
        state.index += 1;
        renderQuestion();
      } else {
        state.mode = 'results'; state.finished = true; save();
        renderResults(); show(els.results);
      }
    }
    function prev() {
      if (state.index > 0) {
        state.index -= 1;
        renderQuestion();
      }
    }

    function renderResults() {
      const total = state.questions.length || 0;
      const right = state.correct;
      const wrong = Math.max(0, total - right);
      els.rightCount.textContent = right;
      els.wrongCount.textContent = wrong;

      const ratio = total ? right / total : 0;
      let msg = '';
      if (ratio === 1) { msg = 'ممتاز! جميع الإجابات صحيحة. — Ausgezeichnet! Alles richtig.'; }
      else if (ratio >= .8) { msg = 'رائع! استمر. — Stark! Weiter so.'; }
      else if (ratio >= .6) { msg = 'جيد، راجع الأخطاء. — Gut, Fehler bitte nacharbeiten.'; }
      else { msg = 'تحتاج مزيداً من التدريب. — Mehr Übung nötig.'; }
      els.scoreMsg.textContent = msg;

      const list = [];
      state.questions.forEach((q, idx) => {
        const chosen = state.answers[idx];
        if (chosen === null) return;
        if (chosen !== q.correctAnswerIndex) {
          list.push({ idx, q });
        }
      });
      if (list.length) {
        els.review.classList.remove('hidden');
        els.reviewList.innerHTML = '';
        list.forEach(item => {
          const { idx, q } = item;
          const chosen = state.answers[idx];
          const el = document.createElement('div');
          el.className = 'review-item';
          el.innerHTML = `
            <div class="review-q"><span class="muted">#${idx + 1}</span> — <span class="ltr"><b>${q.question}</b></span></div>
            <div>✅ الصحيح / Richtig: <span class="ltr"><b>${q.options[q.correctAnswerIndex]}</b></span></div>
            <div>❌ إجابتك / Deine Antwort: <span class="ltr"><b>${q.options[chosen] ?? '—'}</b></span></div>
            ${q.translation ? `<div class="review-ex" style="margin-top:6px">الترجمة: ${q.translation}</div>` : ''}
            ${q.example ? `<div class="review-ex">مثال / Beispiel: <span class="ltr">${q.example}</span></div>` : ''}
          `;
          els.reviewList.appendChild(el);
        });
      } else {
        els.review.classList.add('hidden');
      }
      updateTopbarButtons();
    }

    function goHome() {
      state.mode = 'start'; save();
      renderStart();
      show(els.start);
    }
    function resetAll() {
      if (confirm('سيتم حذف التقدم لهذا النوع من الاختبار فقط. هل أنت متأكد؟\\nFortschritt für diesen Typ wird gelöscht. Sicher?')) {
        if (state.quizType) clearSaved(state.quizType);
        state = initialState();
        renderStart(); show(els.start);
        toast('تمت إعادة التعيين — Zurückgesetzt');
      }
    }

    els.btnGrammar.onclick = () => start('Grammatik');
    els.btnVocab.onclick = () => start('Wortschatz');

    els.homeBtn.onclick = goHome;
    els.homeBtn2.onclick = goHome;
    els.resetBtn.onclick = resetAll;

    els.nextBtn.onclick = next;
    els.prevBtn.onclick = prev;

    els.againBtn.onclick = () => {
      const t = state.quizType || 'Grammatik';
      clearSaved(t);
      start(t);
    };

    renderStart();
  </script>
</body>

</html>